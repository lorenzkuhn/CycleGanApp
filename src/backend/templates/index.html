<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>The Cycle-GAN App</title>
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/style.css') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <!--[if lt IE 9]>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
    <![endif]-->
  </head>
  <body>
    <header>
      <h1>The Cycle-GAN App</h1>
    </header>
    <div>
      <img-container>
        <section>
          <img id='uploaded_image' height='256' width='256'>
        </section>
        <form>
          <div>
            <input id='file_input' type="file" name="file" accept="image/*" required="true">
          </div>
        </form>
        <div class='status_title'>Status: </div><div id='status_text'>Please select image to transform.</div>
      </img-container>
      <img-container>
        <section>
            <img id='inferred_image' height='256' width='256'>
        </section>
      </img-container>
    </div>
    <script>
        function handleErrors(response) {
          if (!response.ok) {
              throw Error(response.statusText);
          }
          return response;
        }
        // uploads an image file to the server,
        // fetches the inferred image and displays it
        function upload(file) {
          const status_text = document.getElementById('status_text');
          document.getElementById('uploaded_image').src = URL.createObjectURL(
              file);
          const url = '/';
          const data = new FormData();
          data.append('file', file);
          fetch(url, { method: 'POST',body: data})
            .then(handleErrors)
            .then((response) => {
              if(!response.ok) {
                throw response;
              }
              return response.blob();
            })
            .then((blob) => {
              const objectUrl = URL.createObjectURL(blob);
              document.getElementById('inferred_image').src = objectUrl;
              status_text.textContent = 'Here you go. Feel free to upload ' +
                  'another image.'
            })
            .catch((error) => {
              console.log("error occurred");
              console.log(error);
              status_text.textContent = error;
            });
        }
        // sets up the app logic, declares required variables,
        // contains all the other functions
        function initialize() {
          const input = document.getElementById('file_input');
          input.addEventListener('change', () => upload(input.files[0]), false);
        }
        initialize();
      </script>
      <!-- Global site tag (gtag.js) - Google Analytics -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=UA-45266465-2"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-45266465-2');
      </script>
  </body>
</html>
